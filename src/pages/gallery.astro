---
import Layout from '../layouts/Layout.astro';
import fs from 'fs';
import PhotoSwipeLightbox from 'photoswipe/lightbox';
import 'photoswipe/style.css';


const files = fs
  .readdirSync('public/gallery')
  .filter((file) => /\.(jpg|jpeg|png)$/i.test(file));

const images = files.map((file) => ({
  src: `/gallery/${file}`,
  alt: file.replace(/\.[^/.]+$/, '').replace(/[_-]/g, ' ')
}));
---

<Layout title="Gallery">
  <div class="container">
    <h1>Gallery</h1>

<div class="grid" id="gallery">
  {images.map((img) => (
    <a
      href={img.src}
      data-pswp-width="1600"
      data-pswp-height="1200"
      target="_blank"
    >
      <img
        src={img.src}
        alt={img.alt}
        loading="lazy"
        class="gallery-img"
      />
    </a>
  ))}
</div>

  </div>

  <script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery',
    children: 'a',
    pswpModule: () => import('photoswipe')
  });

  lightbox.init();
</script>
</Layout>

<style>
.container {
  max-width: 900px;
  margin: 4rem auto;
  padding: 0 1rem;
}

h1 {
  margin-bottom: 2rem;
  font-weight: 400;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1rem;
}

.gallery-img {
  width: 100%;
  height: auto;
  display: block;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.gallery-img:hover {
  transform: scale(1.02);
}
</style>
